<!-- Duplicate Code -->
<section class="clone-section tab-panel" data-tab="clones">
    <div class="tab-heading-row" style="display:none;">
        <h2 class="tab-heading">Duplicate Code</h2>
        <p class="tab-subtitle">Measures of structural duplication across the codebase.</p>
    </div>
    <div class="tab-body">

    {{#if clone_analysis.hasData}}
    <div class="clone-metric-grid">
        <div class="clone-metric-card" style="display:flex;flex-direction:column;justify-content:flex-end;">
            <span class="clone-metric-card__label">Average Similarity</span>
            <span class="clone-metric-card__value">
                {{#if clone_analysis.avgSimilarity}}
                    {{format clone_analysis.avgSimilarity "0.2"}}
                {{else}}
                    —
                {{/if}}
            </span>
        </div>
        <div class="clone-metric-card" style="display:flex;flex-direction:column;justify-content:flex-end;">
            <span class="clone-metric-card__label">Maximum Similarity</span>
            <span class="clone-metric-card__value">
                {{#if clone_analysis.maxSimilarity}}
                    {{format clone_analysis.maxSimilarity "0.2"}}
                {{else}}
                    —
                {{/if}}
            </span>
        </div>
        <div class="clone-metric-card" style="display:flex;flex-direction:column;justify-content:flex-end;">
            <span class="clone-metric-card__label">Candidates</span>
            <span class="clone-metric-card__value">
                {{#if clone_analysis.candidatesAfter}}
                    {{clone_analysis.candidatesAfter}}
                {{else}}
                    —
                {{/if}}
            </span>
        </div>
    </div>

    {{#if clone_pairs.length}}
    <div class="clone-panel-block" style="margin-top: 1rem; border-top: 1px solid rgba(255,255,255,0.026); border-bottom: 1px solid rgba(255,255,255,0.026); padding-top: 0.35rem; padding-bottom: 0.35rem;">
        <script id="clone-pairs-data" type="application/json">{{{json clone_pairs}}}</script>
        <div id="clone-pairs-root" aria-label="Clone pairs cards" style="min-height: 560px;"></div>
        <script>
          (function() {
            function mountPairs() {
              if (!window.ValknutMountClonePairs) {
                if (!window.ReactTreeBundle || typeof window.ReactTreeBundle.mountClonePairs !== 'function') {
                  try {
                    {{inline_js "react-tree-bundle.js"}}
                  } catch (bundleErr) {
                    console.error('[Valknut] inline bundle exec failed for clone pairs', bundleErr);
                    return;
                  }
                }
              }
              var el = document.getElementById('clone-pairs-root');
              var dataEl = document.getElementById('clone-pairs-data');
              if (!el || !dataEl) return;
              try {
                var pairs = JSON.parse(dataEl.textContent || '[]') || [];
                if (typeof window.ValknutMountClonePairs === 'function') {
                  window.ValknutMountClonePairs(pairs, 'clone-pairs-root');
                } else {
                  window.ReactTreeBundle.mountClonePairs(pairs, 'clone-pairs-root');
                }
              } catch (err) {
                console.error('[Valknut] clone pairs mount failed', err);
              }
            }
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
              mountPairs();
            } else {
              document.addEventListener('DOMContentLoaded', mountPairs);
            }
          })();
        </script>
    </div>
    {{/if}}

    {{else}}
    <div class="clone-empty">
        Clone detection was not enabled for this report run.
    </div>
    {{/if}}
    </div>
</section>
